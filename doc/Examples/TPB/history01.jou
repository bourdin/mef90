#!python
cubit.cmd('reset')
cubit.cmd('#{mm=1e-3}')
cubit.cmd('#{mm = 1./90}')
cubit.cmd('#{l = 90*mm}')
cubit.cmd('#{w = 20*mm}')
cubit.cmd('#{h=8*mm}')
cubit.cmd('#{L = 80*mm}')
cubit.cmd('#{a = 2*mm}')
cubit.cmd('#{lc = 2*mm}')
cubit.cmd('#{epsc = .001*mm}')
cubit.cmd('#{theta = 45}')
cubit.cmd('#{hf = .5*mm}')
cubit.cmd('#{hf = 5e-4}')
cubit.cmd('#{hc = 4*mm}')
cubit.cmd('#{hstr = tostring(hf)}')
cubit.cmd('create vertex x 0 y {a} z 0')
cubit.cmd('create vertex x {a/tan(theta)} y 0 z 0')
cubit.cmd('create vertex x {l/2} y 0 z 0')
cubit.cmd('create vertex x {l/2} y {w} z 0')
cubit.cmd('create vertex x {-l/2} y {w} z 0')
cubit.cmd('create vertex x {-l/2} y 0 z 0')
cubit.cmd('create vertex x {-a/tan(theta)} y 0 z 0')
cubit.cmd('create surface vertex all')
cubit.cmd('webcut body all plane xplane offset {-2*a/tan(theta)}')
cubit.cmd('webcut body all plane xplane offset {2*a/tan(theta)}')
cubit.cmd('create vertex x 0 y {w} z 0')
cubit.cmd('create vertex x {L/2} y 0 z 0')
cubit.cmd('create vertex x {-L/2} y 0 z 0')
cubit.cmd('split curve 18 at vertex 16')
cubit.cmd('split curve 15 at vertex 17')
cubit.cmd('split curve 13 at vertex 18')
cubit.cmd('imprint all')
cubit.cmd('merge all')
cubit.cmd('block 1 surface 5')
cubit.cmd('block 2 surface 3 4')
cubit.cmd('sideset 30 curve 1 7')
cubit.cmd('sideset 40 curve 20 21')
cubit.cmd('nodeset 400 vertex 16')
cubit.cmd('nodeset 401 vertex 17')
cubit.cmd('nodeset 402 vertex 18')
cubit.cmd('draw block all')
cubit.cmd('hardcopy "TPB.png" png')
cubit.cmd('surface all scheme trimesh')
cubit.cmd('surface 5 size {hf}')
cubit.cmd('mesh surface 5')
cubit.cmd('curve 3 5 size {hc}')
cubit.cmd('surface 4 sizing function type bias start curve 14 finish curve 3')
cubit.cmd('surface 3 sizing function type bias start curve 8 finish curve 5')
cubit.cmd('mesh surface 3 4')
cubit.cmd('smooth surface all')
cubit.cmd('block 1 to 9 element type tri3')
cubit.cmd('block 10 to 99 element type bar2')
cubit.cmd('#{filename = Quote("TPB-"//hstr//"-tri3.gen")}')
cubit.cmd('export mesh {filename} dimension 2 block all overwrite')
quit
